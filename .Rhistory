tickers = c('GLD','XLP','XLY','TLT','IEF','XLF','VNQ','EEM','SHY','SPY','LQD','XLU')
data = suppressMessages(lapply(tickers, get_data) %>% bind_cols())
colnames(data) = tickers
x <<- matrix(as.numeric(apply(data,2,function(x) return(x/lag(x)-1)) %>% na.omit()),ncol=length(tickers))
z <<- as.factor(rep_len(1:10,nrow(x)) %>% .[order(.)])
obj <- function(b) {
u_sq = (x %*% b - mean(x %*% b))^2
model = lm(u_sq ~ z)
return(as.numeric(summary(model)$fstatistic[1]))
}
S <- slsqp(runif(ncol(x)), fn = obj,
lower = rep(0,ncol(x)))
print(S$message)
print(S$value)
data.frame(symbol = tickers,
weight = round(S$par/sum(S$par),2))
rtn <- x %*% round(S$par/sum(S$par),2)
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 4)
S <- slsqp(runif(ncol(x)), fn = obj,
lower = rep(0,ncol(x)))
print(S$message)
print(S$value)
data.frame(symbol = tickers,
weight = round(S$par/sum(S$par),2))
rtn <- x %*% round(S$par/sum(S$par),2)
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 4)
S <- slsqp(runif(ncol(x)), fn = obj,
lower = rep(0,ncol(x)))
print(S$message)
print(S$value)
tickers = c('GLD','XLP','XLY','TLT','IEF','XLF','VNQ','EEM','SHY','AGG','SPY','LQD','XLU')
data = suppressMessages(lapply(tickers, get_data) %>% bind_cols())
colnames(data) = tickers
x <<- matrix(as.numeric(apply(data,2,function(x) return(x/lag(x)-1)) %>% na.omit()),ncol=length(tickers))
z <<- as.factor(rep_len(1:10,nrow(x)) %>% .[order(.)])
obj <- function(b) {
u_sq = (x %*% b - mean(x %*% b))^2
model = lm(u_sq ~ z)
return(as.numeric(summary(model)$fstatistic[1]))
}
S <- slsqp(runif(ncol(x)), fn = obj,
lower = rep(0,ncol(x)))
print(S$message)
print(S$value)
data.frame(symbol = tickers,
weight = round(S$par/sum(S$par),2))
rtn <- x %*% round(S$par/sum(S$par),2)
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 4)
summary(rtn)
(1+0.0002201)^250
tickers = c('GLD','XLP','XLY','TLT','IEF','XLF','VNQ','EEM','SHY','SPY','LQD','XLU')
tickers = c('GLD','XLP','XLY','TLT','IEF','XLF','VNQ','EEM','SHY','SPY','LQD','XLU','XLK','IJH','IWM')
data = suppressMessages(lapply(tickers, get_data) %>% bind_cols())
colnames(data) = tickers
x <<- matrix(as.numeric(apply(data,2,function(x) return(x/lag(x)-1)) %>% na.omit()),ncol=length(tickers))
z <<- as.factor(rep_len(1:10,nrow(x)) %>% .[order(.)])
obj <- function(b) {
u_sq = (x %*% b - mean(x %*% b))^2
model = lm(u_sq ~ z)
return(as.numeric(summary(model)$fstatistic[1]))
}
S <- slsqp(runif(ncol(x)), fn = obj,
lower = rep(0,ncol(x)))
print(S$message)
print(S$value)
data.frame(symbol = tickers,
weight = round(S$par/sum(S$par),2))
rtn <- x %*% round(S$par/sum(S$par),2)
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 4)
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 2)
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "blue", lwd = 3)
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "red", lwd = 3)
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "red", lwd = 2)
plot(rtn)
plot(rtn[rtn > quantile(rtn,0.005) & rtn < quantile(rtn,0.995)])
plot(rtn[!rtn %in% boxplot.stats(rtn)$out])
plot(rtn)
library(ggplot2)
data_plot = data.frame(x = 1:length(rtn), y = rtn)
ggplot(data = data_plot, aes(x = x,y = y)) + geom_line()
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point()
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth()
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth(se = TRUE)
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth(se = 'lowes')
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth(method = 'lowes')
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth(method = 'lowess')
ggplot(data = data_plot, aes(x = x,y = y)) + geom_point() + geom_smooth()
ggplot(data = data_plot, aes(x = x,y = y)) + geom_smooth()
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "red", lwd = 2)
y = rtn
#y = log(y^2)
y = y^2
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "red", lwd = 2)
y = rtn
y = log(y^2)
model <- lm(y ~ z)
fitted = predict(model,as.data.frame(z))
plot(y)
lines(x = 1:length(fitted), y = fitted, col = "red", lwd = 2)
load("/Users/julianregatky/Documents/GitHub/PreciosClaros/productosCategoriaYCategorias.RData")
head(categorias)
length(unique(categorias$padres))
length(unique(categorias$nombre))
head(unique(categorias$nombre))
categorias$id == "1111205"
categorias[categorias$id == "1111205",]
categorias[order(categorias$id),]
head(productosCategoria)
library(httr)
library(getProxy)
valid_proxy <- FALSE
proxy <- suppressMessages(getProxy())
json <- content(GET('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&',
use_proxy(proxy),
add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),
'parse')
library(jsonlite)
j <- fromJSON('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&')
j <- fromJSON('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&')
json <- content(GET('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&',
add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),
'parse')
library(jsonlite)
?fromJSON
json <- fromJSON('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&')
json$status
length(json)
library(httr)
library(getProxy)
valid_proxy <- FALSE; i <- 0
library(httr)
library(getProxy)
valid_proxy <- FALSE; i <- 0
while(!valid_proxy) {
proxy <- suppressMessages(getProxy())
json <- content(GET('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&',
use_proxy(proxy),
add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),
'parse')
if(length(json) == 5) {
valid_proxy == TRUE
}
i <- i + 1
cat('\r',i)
}
?try
valid_proxy <- FALSE; i <- 0
while(!valid_proxy) {
try(
{
proxy <- suppressMessages(getProxy())
json <- content(GET('https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&',
use_proxy(proxy),
add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),
'parse')
if(length(json) == 5) {
valid_proxy == TRUE
}
},
silent = TRUE
)
i <- i + 1
cat('\r',i)
}
library(rvest)
html <- read_html('https://www.sslproxies.org/')
html
html %>% html_nodes('td')
html %>% html_nodes('td') %>% html_text()
html <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
grep('\d+\.\d+\.\d+\.\d+',source)
grep('[\d+\.\d+\.\d+\.\d+]',source)
grep(source,'[\d+\.\d+\.\d+\.\d+]')
grep(source,'\d+\.\d+\.\d+\.\d+')
grepl(source,'\d+\.\d+\.\d+\.\d+')
?grep
gregexpr(source,'\d+\.\d+\.\d+\.\d+')
gregexpr('\d+\.\d+\.\d+\.\d+',source)
regexpr('\d+\.\d+\.\d+\.\d+',source)
source
library(stringr)
str_count(source,'.')
source
str_count(source,'[.]')
which(str_count(source,'[.]') == 3)
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',which(str_count(source,'[.]') == 3)+1)
proxies
get_proxy_list <- function() {
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',which(str_count(source,'[.]') == 3)+1)
return(proxies)
}
library(httr)
library(rvest)
library(getProxy)
library(stringr)
get_proxy_list <- function() {
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',which(str_count(source,'[.]') == 3)+1)
return(proxies)
}
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
while(!valid_proxy & i <= length(proxies)) {
url <- 'https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&'
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
if(length(json) == 5) {
valid_proxy <- TRUE
}
i <- i + 1
}
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
while(!valid_proxy & i <= length(proxies)) {
url <- 'https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&'
try(
{
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
if(length(json) == 5) {
valid_proxy <- TRUE
}
},
silent = TRUE
)
i <- i + 1
}
proxies[i]
length(proxies)
proxies[1]
i = 1
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
proxies[i]
i = 2
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
i = 3
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
get_proxy_list <- function() {
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',which(str_count(source,'[.]') == 3)+1)
return(proxies)
}
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
proxies
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
source
which(str_count(source,'[.]') == 3)+1
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',source[which(str_count(source,'[.]') == 3)+1])
proxies
get_proxy_list <- function() {
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',source[which(str_count(source,'[.]') == 3)+1])
return(proxies)
}
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
while(!valid_proxy & i <= length(proxies)) {
url <- 'https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&'
try(
{
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
if(length(json) == 5) {
valid_proxy <- TRUE
}
},
silent = TRUE
)
i <- i + 1
}
proxies[i]
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
i = i-1
json <- content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse')
json$status
select_proxy <- function() {
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
while(!valid_proxy & i <= length(proxies)) {
url <- 'https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&'
try(
{
json <- suppressMessages(content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse'))
if(length(json) == 5) {
if(json$status == 200) {
valid_proxy <- TRUE
}
}
},
silent = TRUE
)
i <- i + 1
}
if(valid_proxy) {
return(proxies[i-1])
}
}
proxy = select_proxy()
proxy
get_proxy_list <- function() {
source <- read_html('https://www.sslproxies.org/') %>% html_nodes('td') %>% html_text()
proxies <- paste0(source[which(str_count(source,'[.]') == 3)],':',source[which(str_count(source,'[.]') == 3)+1])
return(sample(proxies))
}
select_proxy <- function() {
proxies <- get_proxy_list(); valid_proxy <- FALSE; i <- 1
while(!valid_proxy & i <= length(proxies)) {
url <- 'https://d3e6htiiul5ek9.cloudfront.net/prod/sucursales?lat=-34.581837774324384&lng=-58.41256489780395&limit=30&'
try(
{
json <- suppressMessages(content(GET(url,use_proxy(proxies[i]),add_headers(.headers = c('User-Agent' = 'Mozilla/5.0'))),'parse'))
if(length(json) == 5) {
if(json$status == 200) {
valid_proxy <- TRUE
}
}
},
silent = TRUE
)
i <- i + 1
}
if(valid_proxy) {
return(proxies[i-1])
}
}
proxy <- select_proxy()
print(proxy)
library(dplyr)
data <- read.csv('/Users/julianregatky/Downloads/SP1.csv')
head(data)
colnames(data)
data <- data %>% select(FTHG,FTAG,AvgH,AvgD,AvgA)
head(data)
data$Home_win <- as.numeric(data$FTHG > data$FTAG)
head(data)
data$Home_prob <- 1/data$AvgH
plot(data$Home_prob,data$Home_win)
library(glm)
model <- glm(data = data,
formula = Home_win ~ Home_prob)
summary(model)
model <- glm(data = data,
formula = Home_win ~ Home_prob + I(Home_prob^2))
summary(model)
model <- glm(data = data,
formula = Home_win ~ log(Home_prob))
summary(model)
library(ggplot2)
ggplot(data = data, aes(x = Home_prob, fill = factor(Home_win), alpha = 0.8)) +
geom_density() +
theme_bw()
data$Home_win <- as.numeric(data$FTHG > data$FTAG)
data$Home_prob <- 1/data$AvgA
ggplot(data = data, aes(x = Home_prob, fill = factor(Home_win), alpha = 0.8)) +
geom_density() +
theme_bw()
data$Home_win <- as.numeric(data$FTHG == data$FTAG)
data$Home_prob <- 1/data$AvgD
ggplot(data = data, aes(x = Home_prob, fill = factor(Home_win), alpha = 0.8)) +
geom_density() +
theme_bw()
setwd('/Users/julianregatky/Documents/GitHub/client_churn_ML2020')
train <- read.table('train.csv', header = T, sep =',', dec = '.')
hist(train$age)
if (!require('pacman')) install.packages('pacman')
pacman::p_load(tidyverse,mlr)
rm(train)
dataset <- read.table('train.csv', header = T, sep =',', dec = '.')
colnames(dataset)
dataset <- removeConstantFeatures(dataset,
perc = 0.01,
dont.rm = 'TARGET')
dataset <- read.table('train.csv', header = T, sep =',', dec = '.')
table(dataset$imp_op_var40_comer_ult1)
prop.table(table(dataset$imp_op_var40_comer_ult1))
9.957283e-01
getAnywhere(removeConstantFeatures())
# Eliminamos features cuasi-constantes
dataset <- removeConstantFeatures(dataset,
perc = 0.01, # Fijamos threshold del 99%
dont.rm = 'TARGET')
del <- c()
for(i in 1:ncol(dataset)) {
for(j in (i+1):ncol(dataset)) {
if(dataset[,i] == dataset[,j]) {
del <- c(del,i)
}
}
}
del <- c()
for(i in 1:(ncol(dataset)-1)) {
for(j in (i+1):ncol(dataset)) {
if(dataset[,i] == dataset[,j]) {
del <- c(del,i)
}
}
}
warnings()
del <- c()
for(i in 1:(ncol(dataset)-1)) {
for(j in (i+1):ncol(dataset)) {
if(identical(dataset[,i],dataset[,j])) {
del <- c(del,i)
}
}
}
colnames(dataset[,30])
colnames(dataset)[c(30,33,37,57,59,73)]
table(dataset[,30])
table(dataset[,33])
table(dataset[,37])
table(dataset[,57])
x <- c()
y <- c()
for(i in 1:(ncol(dataset)-1)) {
for(j in (i+1):ncol(dataset)) {
if(identical(dataset[,i],dataset[,j])) {
x <- c(x,i)
y <- c(y,j)
}
}
}
table(data[,30])
table(dataset[,30])
table(dataset[,32])
table(dataset[,33])
table(dataset[,34])
colnames(dataset)[c(30,32)]
# Unificamos features duplicados
del_col <- c()
for(i in 1:(ncol(dataset)-1)) {
for(j in (i+1):ncol(dataset)) {
if(identical(dataset[,i],dataset[,j])) {
# identificamos columnas identicas en el data.frame
del_col <- c(del_col,j)
}
}
}
dataset <- dataset[,setdiff(1:ncol(dataset),del_col)]
hist(dataset$age)
ggplot(data = dataset, aes(x = age, fill = factor(TARGET), alpha = 0.8)) +
geom_density() +
theme_bw()
ggplot(data = dataset, aes(x = log(age), fill = factor(TARGET), alpha = 0.8)) +
geom_density() +
theme_bw()
ggplot(data = dataset, aes(x = age, fill = factor(TARGET), alpha = 0.8)) +
geom_density() +
theme_bw()
ggplot(data = dataset, aes(x = var38, fill = factor(TARGET), alpha = 0.8)) +
geom_density() +
theme_bw()
ggplot(data = dataset, aes(x = log(var38), fill = factor(TARGET), alpha = 0.8)) +
geom_density() +
theme_bw()
plot(dataset[,1:4])
pacman::p_load(tidyverse,mlr,glmnet)
colnames(dataset)
str(dataset)
data_plot <- removeConstantFeatures(dataset,
perc = 0.1, # Fijamos threshold del 99%
dont.rm = 'TARGET')
data_plot <- removeConstantFeatures(dataset,
perc = 0.2, # Fijamos threshold del 99%
dont.rm = 'TARGET')
data_plot <- removeConstantFeatures(dataset,
perc = 0.3, # Fijamos threshold del 99%
dont.rm = 'TARGET')
data_plot <- removeConstantFeatures(dataset,
perc = 0.5, # Fijamos threshold del 99%
dont.rm = 'TARGET')
plot(data_plot)
data_plot <- removeConstantFeatures(dataset,
perc = 0.7, # Fijamos threshold del 99%
dont.rm = 'TARGET')
data_plot <- removeConstantFeatures(dataset,
perc = 0.6, # Fijamos threshold del 99%
dont.rm = 'TARGET')
data_plot <- removeConstantFeatures(dataset,
perc = 0.7, # Fijamos threshold del 99%
dont.rm = 'TARGET')
plot(data_plot)
data_plot <- removeConstantFeatures(dataset,
perc = 0.7)
plot(data_plot)
